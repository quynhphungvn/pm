<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wbs</title>
  <!-- <link rel="stylesheet" href="../../libs/semantic-ui/semantic.min.css"> -->
  
  <link rel="stylesheet" href="../../libs/bootstrap/css/bootstrap-utilities.css">
  <link rel="stylesheet" href="../../libs/fontawesome-free-6.4.2-web/css/fontawesome.min.css">
  <link rel="stylesheet" href="../../libs/fontawesome-free-6.4.2-web/css/brands.min.css">
  <link rel="stylesheet" href="../../libs/fontawesome-free-6.4.2-web/css/solid.min.css">
  <link rel="stylesheet" href="../../libs/css-custom/styles.css">
  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css">

</head>

<body>
  <div id="main-wrapper" class="d-flex">
    <nav class="nav-bar bg-light">
      <header class="text-center p-4 border-bottom">
        <a href="" class="fs-4">
          <i class="home icon"></i>
        </a>
      </header>
      <div class="ui secondary vertical menu w-100 mt-5">
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          Plan
          <div class="menu">
            <a class="item">Requirement</a>
            <a class="item">WBS</a>
            <a class="item">Gantt</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          DB
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          Flow
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          Class
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          Test
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          UI
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
        <div class="ui dropdown item">
          <i class="dropdown icon"></i>
          SP
          <div class="menu">
            <div class="header">Text Size</div>
            <a class="item">Small</a>
            <a class="item">Medium</a>
            <a class="item">Large</a>
          </div>
        </div>
      </div>
    </nav>
    <aside class="left-bar border-end">
      <header class="d-flex align-items-center border-bottom">
        <div class="ui breadcrumb">
          <a class="section">Home</a>
          <div class="divider"> / </div>
          <a class="section">Store</a>
          <div class="divider"> / </div>
          <div class="active section">T-Shirt</div>
        </div>    
      </header>
      <main>
        <div class="ui vertical menu w-100 mt-2">
          <a href="https://www.google.com" class="item active">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
          <a href="https://www.google.com" class="item">
            Visit Google
          </a>
        </div>
      </main>
      <footer class="d-flex align-items-center">
        <div class="ui left pointing dropdown icon button">
          <i class="settings icon"></i>
          <div class="menu">
            <button class="item w-100" onclick="showModalAdd()">
              <i class="plus icon"></i>
              Add
            </button>
            <button class="item w-100" onclick="showModalEdit()">
              <i class="edit icon"></i>
              Edit
            </button>
            <button class="item w-100" onclick="deleteWbs(1,'Wbs 1')">
              <i class="trash icon"></i>
              Delete
            </button>
          </div>
        </div>
        <div class="ui mini modal add">
          <div class="header">
            Add Query
          </div>
          <div class="content">
            <form class="ui form" name="add">
              <div class="field">
                <label>Name</label>
                <input type="text" name="query-name" placeholder="Name">
              </div>
              <button class="ui button" type="submit">Add</button>
            </form>
          </div>
        </div>
        <div class="ui modal edit">
          <div class="header">
            Edit Query Name
          </div>
          <div class="content">
            <form class="ui form" name="edit">
              <div class="mb-3">
                <label>Name: </label>
                <strong>Query 1</strong>
              </div>
              <div class="field">
                <label>New Name</label>
                <input type="text" name="new-name" placeholder="New Name">
              </div>
              <button class="ui button" type="submit">Update</button>
            </form>
          </div>
        </div>

      </footer>
    </aside>
    <main class="main-content">
      <header class="d-flex align-items-center">
        <h3 class="ms-5 text-success">Query 1</h3>
      </header>
      <main class="p-4">
        <div class="info-wrapper flow">        
          <section>
            <h4 class="ui header fs-3">Queries</h4>
            <form class="ui form" name="class-specification">
              <div class="field">
                <textarea rows="38" readonly>
import org.apache.http.message.BasicHttpEntityEnclosingRequest;
import org.apache.http.message.BasicHttpRequest;
import org.apache.http.message.HeaderGroup;
import org.apache.http.util.EntityUtils;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.Closeable;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpCookie;
import java.net.URI;
import java.util.BitSet;
import java.util.Enumeration;
import java.util.Formatter;

/**
 * An HTTP reverse proxy/gateway servlet. It is designed to be extended for customization
 * if desired. Most of the work is handled by
 * <a href="http://hc.apache.org/httpcomponents-client-ga/">Apache HttpClient</a>.
 * <p>
 *   There are alternatives to a servlet based proxy such as Apache mod_proxy if that is available to you. However
 *   this servlet is easily customizable by Java, secure-able by your web application's security (e.g. spring-security),
 *   portable across servlet engines, and is embeddable into another web application.
 * </p>
 * <p>
 *   Inspiration: http://httpd.apache.org/docs/2.0/mod/mod_proxy.html
 * </p>
 *
 * @author David Smiley dsmiley@apache.org
 */
@SuppressWarnings({"deprecation", "serial", "WeakerAccess"})
public class ProxyServlet extends HttpServlet {

  /* INIT PARAMETER NAME CONSTANTS */

  /** A boolean parameter name to enable logging of input and target URLs to the servlet log. */
  public static final String P_LOG = "log";

  /** A boolean parameter name to enable forwarding of the client IP  */
  public static final String P_FORWARDEDFOR = "forwardip";

  /** A boolean parameter name to keep HOST parameter as-is  */
  public static final String P_PRESERVEHOST = "preserveHost";

  /** A boolean parameter name to keep COOKIES as-is  */
  public static final String P_PRESERVECOOKIES = "preserveCookies";

  /** A boolean parameter name to keep COOKIE path as-is  */
  public static final String P_PRESERVECOOKIEPATH = "preserveCookiePath";

  /** A boolean parameter name to have auto-handle redirects */
  public static final String P_HANDLEREDIRECTS = "http.protocol.handle-redirects"; // ClientPNames.HANDLE_REDIRECTS

  /** An integer parameter name to set the socket connection timeout (millis) */
  public static final String P_CONNECTTIMEOUT = "http.socket.timeout"; // CoreConnectionPNames.SO_TIMEOUT

  /** An integer parameter name to set the socket read timeout (millis) */
  public static final String P_READTIMEOUT = "http.read.timeout";

  /** An integer parameter name to set the connection request timeout (millis) */
  public static final String P_CONNECTIONREQUESTTIMEOUT = "http.connectionrequest.timeout";

  /** An integer parameter name to set max connection number */
  public static final String P_MAXCONNECTIONS = "http.maxConnections";

  /** A boolean parameter whether to use JVM-defined system properties to configure various networking aspects. */
  public static final String P_USESYSTEMPROPERTIES = "useSystemProperties";

  /** A boolean parameter to enable handling of compression in the servlet. If it is false, compressed streams are passed through unmodified. */
  public static final String P_HANDLECOMPRESSION = "handleCompression";

  /** The parameter name for the target (destination) URI to proxy to. */
  public static final String P_TARGET_URI = "targetUri";

  protected static final String ATTR_TARGET_URI =
          ProxyServlet.class.getSimpleName() + ".targetUri";
  protected static final String ATTR_TARGET_HOST =
          ProxyServlet.class.getSimpleName() + ".targetHost";

  /* MISC */

  protected boolean doLog = false;
  protected boolean doForwardIP = true;
  /** User agents shouldn't send the url fragment but what if it does? */
  protected boolean doSendUrlFragment = true;
  protected boolean doPreserveHost = false;
  protected boolean doPreserveCookies = false;
  protected boolean doPreserveCookiePath = false;
  protected boolean doHandleRedirects = false;
  protected boolean useSystemProperties = true;
  protected boolean doHandleCompression = false;
  protected int connectTimeout = -1;
  protected int readTimeout = -1;
  protected int connectionRequestTimeout = -1;
  protected int maxConnections = -1;

  //These next 3 are cached here, and should only be referred to in initialization logic. See the
  // ATTR_* parameters.
  /** From the configured parameter "targetUri". */
  protected String targetUri;
  protected URI targetUriObj;//new URI(targetUri)
  protected HttpHost targetHost;//URIUtils.extractHost(targetUriObj);

  private HttpClient proxyClient;

  @Override
  public String getServletInfo() {
    return "A proxy servlet by David Smiley, dsmiley@apache.org";
  }


  protected String getTargetUri(HttpServletRequest servletRequest) {
    return (String) servletRequest.getAttribute(ATTR_TARGET_URI);
  }

  protected HttpHost getTargetHost(HttpServletRequest servletRequest) {
    return (HttpHost) servletRequest.getAttribute(ATTR_TARGET_HOST);
  }

  /**
   * Reads a configuration parameter. By default it reads servlet init parameters but
   * it can be overridden.
   */
  protected String getConfigParam(String key) {
    return getServletConfig().getInitParameter(key);
  }

  @Override
  public void init() throws ServletException {
    String doLogStr = getConfigParam(P_LOG);
    if (doLogStr != null) {
      this.doLog = Boolean.parseBoolean(doLogStr);
    }

    String doForwardIPString = getConfigParam(P_FORWARDEDFOR);
    if (doForwardIPString != null) {
      this.doForwardIP = Boolean.parseBoolean(doForwardIPString);
    }

    String preserveHostString = getConfigParam(P_PRESERVEHOST);
    if (preserveHostString != null) {
      this.doPreserveHost = Boolean.parseBoolean(preserveHostString);
    }

    String preserveCookiesString = getConfigParam(P_PRESERVECOOKIES);
    if (preserveCookiesString != null) {
      this.doPreserveCookies = Boolean.parseBoolean(preserveCookiesString);
    }

    String preserveCookiePathString = getConfigParam(P_PRESERVECOOKIEPATH);
    if (preserveCookiePathString != null) {
      this.doPreserveCookiePath = Boolean.parseBoolean(preserveCookiePathString);
    }

    String handleRedirectsString = getConfigParam(P_HANDLEREDIRECTS);
    if (handleRedirectsString != null) {
      this.doHandleRedirects = Boolean.parseBoolean(handleRedirectsString);
    }

    String connectTimeoutString = getConfigParam(P_CONNECTTIMEOUT);
    if (connectTimeoutString != null) {
      this.connectTimeout = Integer.parseInt(connectTimeoutString);
    }

    String readTimeoutString = getConfigParam(P_READTIMEOUT);
    if (readTimeoutString != null) {
      this.readTimeout = Integer.parseInt(readTimeoutString);
    }

    String connectionRequestTimeout = getConfigParam(P_CONNECTIONREQUESTTIMEOUT);
    if (connectionRequestTimeout != null) {
      this.connectionRequestTimeout = Integer.parseInt(connectionRequestTimeout);
    }

    String maxConnections = getConfigParam(P_MAXCONNECTIONS);
    if (maxConnections != null) {
      this.maxConnections = Integer.parseInt(maxConnections);
    }

    String useSystemPropertiesString = getConfigParam(P_USESYSTEMPROPERTIES);
    if (useSystemPropertiesString != null) {
      this.useSystemProperties = Boolean.parseBoolean(useSystemPropertiesString);
    }

    String doHandleCompression = getConfigParam(P_HANDLECOMPRESSION);
    if (doHandleCompression != null) {
      this.doHandleCompression = Boolean.parseBoolean(doHandleCompression);
    }

    initTarget();//sets target*

    proxyClient = createHttpClient();
  }

  /**
   * Sub-classes can override specific behaviour of {@link org.apache.http.client.config.RequestConfig}.
   */
  protected RequestConfig buildRequestConfig() {
    return RequestConfig.custom()
            .setRedirectsEnabled(doHandleRedirects)
            .setCookieSpec(CookieSpecs.IGNORE_COOKIES) // we handle them in the servlet instead
            .setConnectTimeout(connectTimeout)
            .setSocketTimeout(readTimeout)
            .setConnectionRequestTimeout(connectionRequestTimeout)
            .build();
  }

  /**
   * Sub-classes can override specific behaviour of {@link org.apache.http.config.SocketConfig}.
   */
  protected SocketConfig buildSocketConfig() {

    if (readTimeout < 1) {
      return null;
    }

    return SocketConfig.custom()
            .setSoTimeout(readTimeout)
            .build();
  }
                </textarea>
              </div>   
              <div class="d-flex justify-content-end">
                <button class="ui button d-none btn-update-spec">Update</button>
                <button type="button" class="ui icon button" onclick="enableEditMode()"><i class="edit icon"></i></button>    
              </div>         
            </form>
            
          </section>
        </div>
      </main>   
    </main>
  </div>
  <script src="../../libs/css-custom/scripts.js"></script>
  <script src="../../libs/jquery-3.1.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
  <script>
    $(document).ready(()=> {
      setUpOffCanvas();
    });
    $('.dropdown').dropdown({
      label: {
        duration: 0,
      },
      debug: true,
      performance: true,
    });
    $('.ui.accordion').accordion();

    function showModalAdd() {
      $('.ui.modal.add')
        .modal('show')
        ;
    }
    function showModalEdit() {
      $('.ui.modal.edit')
        .modal('show')
        ;
    }
    function deleteWbs(id, name) {
      if (confirm("Delete Wbs " + name + "?") == true) {
        alert("Deleted");
      }
    }
    function openSideBar() {
      $('.ui.sidebar.diagram')
        .sidebar('setting', 'transition', 'overlay')
        .sidebar('toggle')
      ;
    }
    function enableEditMode() {
      $("form[name='class-specification'] textarea").attr("readonly", false);
      $("form[name='class-specification'] button.btn-update-spec").removeClass("d-none");
    }
    
  </script>

  <!-- <script src="../../libs/semantic-ui/semantic.min.js"></script> -->
</body>

</html>